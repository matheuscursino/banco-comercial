<!DOCTYPE html>
<html>
  <head>
    <title>Deletar cliente</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../view/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../view/images/favicon-16x16.png"
    />
    <link rel="manifest" href="../view/images/site.webmanifest" />
    <style>
      body {
        margin: 0px;
        padding: 0px;
        font-family: "Arial";
      }

      h1 {
        text-align: center;
      }

      form {
        width: 80%;
        height: auto;
        margin: auto;
      }

      h1 {
        margin-top: 20px;
      }

      #tabelaDiv {
        width: 80%;
        margin: auto;
        display: none;
        margin-top: 50px;
        text-align: center;
        padding: 50px;
        border: 1px solid rgba(255, 0, 0, 0.185);
        border-radius: 10px;
      }

      .notification {
        margin-top: 20px;
        width: 80%;
        margin-left: auto;
        margin-right: auto;
      }

      @media screen and (max-width: 1024px) {
        .navbar-dropdown .is-active {
          display: block;
        }
        .navbar-dropdown:not(.is-active) {
          display: none;
        }
      }

      .box {
        width: 80%;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <nav class="navbar is-light">
      <div class="navbar-brand">
        <a class="navbar-item" href="/bancorm">
          <img src="../view/images/favicon-32x32.png" width="32" height="32" />
        </a>
        <div
          id="burger"
          class="navbar-burger"
          data-target="navbarExampleTransparentExample"
        >
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <div id="navbarExampleTransparentExample" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item" href="/bancorm"> Home </a>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link"> Cliente </a>
            <div class="navbar-dropdown is-boxed">
              <a class="navbar-item" href="/bancorm/cliente/incluir">
                Incluir
              </a>
              <a class="navbar-item" href="/bancorm/cliente/atualizar">
                Atualizar
              </a>
              <a class="navbar-item" href="/bancorm/cliente/consultar">
                Consultar
              </a>
              <a class="navbar-item" href="/bancorm/cliente/listar"> Listar </a>
              <a class="navbar-item" href="/bancorm/cliente/deletar">
                Deletar
              </a>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link"> Conta corrente </a>
            <div class="navbar-dropdown is-boxed">
              <a class="navbar-item" href="/bancorm/contacorrente/incluir">
                Incluir
              </a>
              <a class="navbar-item" href="/bancorm/contacorrente/atualizar">
                Atualizar
              </a>
              <a class="navbar-item" href="/bancorm/contacorrente/consultar">
                Consultar
              </a>
              <a class="navbar-item" href="/bancorm/contacorrente/listar">
                Listar
              </a>
              <a class="navbar-item" href="/bancorm/contacorrente/deletar">
                Deletar
              </a>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link"> Transação </a>
            <div class="navbar-dropdown is-boxed">
              <a class="navbar-item" href="/bancorm/transacao/incluir">
                Incluir
              </a>
              <a class="navbar-item" href="/bancorm/transacao/atualizar">
                Atualizar
              </a>
              <a class="navbar-item" href="/bancorm/transacao/consultar">
                Consultar
              </a>
              <a class="navbar-item" href="/bancorm/transacao/listar">
                Listar
              </a>
              <a class="navbar-item" href="/bancorm/transacao/deletar">
                Deletar
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div id="all" class="content">
      <h1>DELETAR CLIENTE</h1>
      <div class="box">
        <form id="formulario">
          <div class="field">
            <label class="label">CPF do cliente: </label>
            <div class="control">
              <input
                class="input"
                placeholder="Digite o cpf do cliente aqui..."
                type="number"
                name="cpf"
                id="cpf"
              />
            </div>
          </div>
          <button class="button is-link" onclick="consultar()" type="submit">
            Apagar
          </button>
          <button class="button is-link is-light" onclick="form.reset()">
            Limpar
          </button>
        </form>
      </div>
      <div class="box" id="tabelaDiv">
        <h3>Deseja mesmo apagar o cliente abaixo?</h3>
        <table class="table is-bordered" id="tabela">
          <thead>
            <tr>
              <th>cli_cpf</th>
              <th>cli_nome</th>
              <th>cli_tel</th>
            </tr>
          </thead>
          <tbody id="tabela-colunas"></tbody>
        </table>
        <button onclick="deletar()" class="button is-danger">Apagar</button>
      </div>
    </div>
  </body>
  <script>
    var botaoBurger = document.getElementById("burger");

    botaoBurger.addEventListener("click", (e) => {
      const target = botaoBurger.dataset.target;
      const eTarget = document.getElementById(target);

      botaoBurger.classList.toggle("is-active");
      eTarget.classList.toggle("is-active");
    });

    const allDropdowns = document.querySelectorAll(".navbar-item.has-dropdown");

    allDropdowns.forEach((dropdown) => {
      dropdown.addEventListener("click", () => {
        const elemento = dropdown.querySelector(".navbar-dropdown");
        elemento.classList.toggle("is-active");
      });
    });

    var tabelaDiv = document.getElementById("tabelaDiv");
    var tabelaBody = document.getElementById("tabela-colunas");
    var form = document.getElementById("formulario");
    var all = document.getElementById("all");
    var cpf_valor;

    form.addEventListener("submit", (e) => {
      e.preventDefault();
    });

    function consultar() {
      tabelaDiv.style.display = "none";
      cpf_valor = document.getElementById("cpf").value;

      let formData = new FormData();
      formData.append("cpf", cpf_valor);
      formData.append("tipoConsulta", 1);

      var init = {
        method: "POST",
        body: formData,
      };

      fetch("consultar/consultar", init).then((response) => {
        response
          .json()
          .then((data) => {
            console.log(data);
            var dataArray = data.message;

            if (dataArray.length != 0) {
              tabelaBody.innerHTML = "";
              tabelaDiv.style.display = "block";
              dataArray.forEach((element) => {
                tabelaBody.innerHTML += `<tr>
                 <td>${element.cli_cpf}</td>
                 <td>${element.cli_nome}</td>
                 <td>${element.cli_telefone}</td>
                 </tr>`;
              });
            } else {
              all.insertAdjacentHTML(
                "afterBegin",
                "<div class='notification is-danger'> <button onclick='this.parentNode.remove()' class='delete'></button> O cliente com o CPF indicado não foi encontrado! <strong> Clique <a href='/bancorm/cliente/listar'>aqui</a> para conferir o CPF de todos os cliente.  </div>"
              );
            }
          })
          .catch((error) => {});
      });
    }

    function deletar() {
      let formData = new FormData();
      formData.append("cpf", cpf_valor);

      var init = {
        method: "POST",
        body: formData,
      };

      fetch("deletar/apagar", init)
        .then((response) => {
          if (response.status == 200) {
            tabelaDiv.style.display = "none";
            all.insertAdjacentHTML(
              "afterBegin",
              "<div class='notification is-success'> <button onclick='this.parentNode.remove()' class='delete'></button> O cliente com o CPF indicado foi deletado! <strong> Clique <a href='/bancorm'>aqui</a> para manipular outras entidades.  </div>"
            );
          } else {
            alert("Aconteceu algum erro ao tentar deletar o cliente");
          }
        })
        .catch((error) => {
          alert("Erro ao fazer a requisição");
        });
    }
  </script>
</html>
